id: edit-brand
type: PageSiderMenu
properties:
  title: Edit Brand
layout:
  contentGutter: 16 # Set a gutter of 16px between all the blocks on the page

actions:
  onEnter:
    - id: fetch_brand
      type: Fetch
      params: get_brand
    - id: set_brand_info
      type: SetState
      params:
        _request: get_brand # Fetch the brand request when you enter the page

requests:
  - id: get_brand
    type: MongoDBFindOne # MongoDb Find One query to get the brand data
    connectionId: brands
    properties:
      query:
        _id:
          _input: brand_id # Query for the brand by matching the document in the collection's _id with the brand_id passed through as an input from the brands page

mutations:
  - id: update_brand
    type: MongoDBUpdateOne # MongoDb updateOne mutation to update the brand
    connectionId: brands
    properties:
      filter:
        _id:
          _state: _id # Filter the document that matches the document's _id
      update:
        $set:
          name:
            _state: name # Insert the brand name we set in state
          description:
            _state: description # Insert the description name we set in state
  - id: delete_brand
    type: MongoDBDeleteOne # MongoDb deleteOne mutation to delete the brand's document from the collection
    connectionId: brands
    properties:
      filter:
        _id:
          _state: _id # Filter the document that matches the document's _id

blocks:
  - id: edit_brand_title # Create a Title block
    type: Title
    properties:
      content: Edit Brand # The title's text
  - id: name
    type: TextInput
    properties:
      title: Name
      placeholder: Brand Name
  - id: description
    type: TextArea
    properties:
      title: Description
      placeholder: Brand Description
  - id: update_brand
    type: Button
    layout:
      span: 12 # Make the button span 2 half of the drawer's width
    properties:
      title: Save
      icon: SaveOutlined
      block: true
    actions:
      onClick:
        - id: update_brand  # Call the update_brand mutation
          type: Mutate
          params: update_brand
        - id: link_brands # Link back to the brands page
          type: Link
          params:
            pageId: brands
  - id: back
    type: Button
    layout:
      span: 6
    properties:
      title: Back
      icon: ArrowLeftOutlined
      type: default # Change the type of the button to default
      block: true # Makes the button fill the maximum defined width instead of only the with of its contents (title and icon)
    actions:
      onClick:
        - id: link_brands # Link back to the brands page
          type: Link
          params:
            pageId: brands
  - id: delete_brand # Button for deleting the brand
    type: Button
    layout:
      span: 6
    properties:
      title: Delete
      icon: DeleteOutlined
      type: danger # Set the type of button to a danger button (which is red in color)
      block: true
    actions:
      onClick:
        - id: open_delete_modal # Open a pop up modal to confirm whether you want to delete the brand
          type: CallMethod
          params:
            blockId: delete_modal
            method: open
  - id: delete_modal
    type: ConfirmModal
    properties:
      content: Are you sure you want to delete this brand? # The text inside the modal
      okText: Yes # Change the default text of the ok button to 'Yes'
      okButton:
        type: danger # Change the default type of the ok button to danger
      cancelText: No # Change the default text of the cancel button to 'No'
    actions:
      onOk:
        - id: delete_brand
          type: Mutate
          params: delete_brand
        - id: link_brands # Link back to the brands page
          type: Link
          params:
            pageId: brands